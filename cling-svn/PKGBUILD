# Maintainer: Daniel Micay <danielmicay@gmail.com>
pkgname=cling-svn
pkgver=43858
pkgrel=1
pkgdesc="Interactive C++ interpreter and JIT compiler"
arch=('i686' 'x86_64')
url="http://llvm.org/"
license=('custom:University of Illinois/NCSA Open Source License')
depends=('gcc-libs' 'libffi' 'python2' "gcc")
makedepends=('svn' 'cmake')
provides=('clang' 'llvm')
conflicts=(llvm llvm-svn llvm-ocaml clang clang-analyzer)
options=(!buildflags)

_svntrunk="http://root.cern.ch/svn/root/trunk/cint/cling"
_svnmod="cling"

_llvm_repo=http://llvm.org/svn/llvm-project

build() {
  cd "$srcdir"

  rev=155160

  svn co $_llvm_repo/llvm/trunk llvm -r $rev

  cd llvm/tools
  svn co $_llvm_repo/cfe/trunk clang -r $rev
  svn co http://root.cern.ch/svn/root/trunk/cint/cling

  cd ..
  cat tools/cling/patches/*.diff | patch -p0

  cd ..
  cd llvm/projects
  svn co $_llvm_repo/compiler-rt/trunk compiler-rt -r $rev

  cd ../..

  [[ -d build ]] && rm -r build

  mkdir build
  cd build
  ../llvm/configure --enable-optimized --enable-targets=host
  make
}

package() {
  cd "$srcdir/build"

  make DESTDIR=$pkgdir install
}
